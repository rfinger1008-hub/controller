<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨åŠŸèƒ½è…³æœ¬å„€è¡¨æ¿</title>
    <style>
        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f2f5; margin: 0; padding: 20px; box-sizing: border-box; }
        
        /* å¯¬ç‰ˆå¡ç‰‡è¨­å®š */
        .card { 
            background: white; 
            padding: 2rem; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            width: 100%; 
            max-width: 900px; /* è®Šå¯¬äº† */
            text-align: center; 
        }

        /* è¼¸å…¥æ¡†èˆ‡é¸å–®æ¨£å¼ */
        input[type="text"], input[type="password"], input[type="email"], input[type="number"], select {
            width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline: none; text-align: center; background: #fafafa; font-size: 14px;
        }
        input:focus, select:focus { border-color: #007bff; background: white; }
        select { cursor: pointer; text-align-last: center; }

        /* æŒ‰éˆ•æ¨£å¼ */
        button { width: 100%; padding: 15px; margin-top: 15px; border: none; border-radius: 12px; cursor: pointer; color: white; font-weight: bold; font-size: 18px; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        button:active { transform: scale(0.98); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .btn-login { background-color: #007bff; }
        .btn-start { 
            background: linear-gradient(135deg, #28a745 0%, #218838 100%); 
            font-size: 20px; 
        }
        .btn-logout { background-color: #6c757d; font-size: 14px; padding: 10px; width: auto; margin-top: 30px; box-shadow: none; }

        /* --- ç¶²æ ¼ä½ˆå±€ç³»çµ± (Grid) --- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); /* è‡ªå‹•é©æ‡‰å¯¬åº¦ï¼Œæœ€çª„260px */
            gap: 15px;
            margin-top: 15px;
            text-align: left;
        }

        /* åŠŸèƒ½æ¨¡çµ„ç›’å­ */
        .module-box {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 12px;
            position: relative;
            transition: 0.2s;
        }
        .module-box:hover { border-color: #b3d7ff; box-shadow: 0 5px 15px rgba(0,123,255,0.05); }

        /* æ¨¡çµ„æ¨™é¡Œåˆ— (å« Checkbox) */
        .module-header {
            display: flex;
            align-items: center;
            border-bottom: 2px solid #f5f5f5;
            padding-bottom: 8px;
            margin-bottom: 8px;
        }
        .module-title { font-weight: bold; color: #444; font-size: 15px; flex: 1; margin-left: 8px; }
        
        /* Checkbox æ”¾å¤§ */
        input[type="checkbox"].toggle-module {
            width: 18px; height: 18px; cursor: pointer; accent-color: #007bff;
        }

        /* èµ·å§‹æ¨¡å¼é¸æ“‡å€ */
        .start-mode-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #bbdefb;
        }
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 5px;
        }
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: bold;
            color: #1565c0;
            font-size: 15px;
            background: white;
            padding: 8px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .radio-label input { margin-right: 6px; width: auto; }

        /* æç¤ºæ–‡å­— */
        .hint-text { font-size: 12px; color: #888; margin-top: 5px; text-align: center; }
        .section-hint { font-size: 13px; color: #5c6bc0; margin-bottom: 5px; font-weight: bold; }

        .hidden { display: none; }
        #status { margin-top: 20px; font-size: 14px; color: #666; font-weight: 500; }
    </style>
</head>
<body>

<div class="card">
    <h2 style="margin-bottom: 5px;">ğŸ› ï¸ å…¨åŠŸèƒ½è…³æœ¬æ§åˆ¶å°</h2>
    <p id="user-display" style="font-size: 13px; color: #aaa; margin-top: 0;">è«‹å…ˆç™»å…¥</p>
    
    <div id="login-area">
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="å¯†ç¢¼">
        <button id="btnLogin" class="btn-login">ç™»å…¥ç³»çµ±</button>
    </div>

    <div id="control-area" class="hidden">

        <div class="start-mode-section">
            <div class="section-hint">ğŸš€ è…³æœ¬å•Ÿå‹•å¾Œï¼Œå„ªå…ˆé€²å…¥å“ªå€‹æ¨¡å¼ï¼Ÿ</div>
            <div class="radio-group">
                <label class="radio-label"><input type="radio" name="startMode" value="LEAGUE" checked> è¯è³½</label>
                <label class="radio-label"><input type="radio" name="startMode" value="RANKING"> æ’å</label>
                <label class="radio-label"><input type="radio" name="startMode" value="ARENA"> ç«¶æŠ€</label>
                <label class="radio-label"><input type="radio" name="startMode" value="STAGE"> é—œå¡</label>
                <label class="radio-label"><input type="radio" name="startMode" value="CLUB"> ä¿±æ¨‚éƒ¨</label>
            </div>
            <div class="hint-text">(é€™æ±ºå®šç¬¬ä¸€æ­¥åšä»€éº¼ï¼Œå¾ŒçºŒæœƒä¾ç…§ä¸‹æ–¹å‹¾é¸çš„æ¨¡å¼é€²è¡Œæ›æ©Ÿ)</div>
        </div>

        <div class="dashboard-grid">

            <div class="module-box">
                <div class="module-header">
                    <input type="checkbox" id="run_league" class="toggle-module" checked>
                    <span class="module-title" style="color: #d35400;">ğŸ† è¯è³½å¾ªç’°</span>
                </div>
                <label><input type="checkbox" id="league_equip" checked> è‡ªå‹•ç©¿è£</label>
                <label><input type="checkbox" id="league_potion" checked> è‡ªå‹•å–æ°´</label>
            </div>

            <div class="module-box">
                <div class="module-header">
                    <input type="checkbox" id="run_ranking" class="toggle-module" checked>
                    <span class="module-title" style="color: #27ae60;">ğŸ¥‡ æ’åè³½</span>
                </div>
                <label><input type="checkbox" id="ranking_equip"> è‡ªå‹•ç©¿è£</label>
                <label><input type="checkbox" id="ranking_potion"> è‡ªå‹•å–æ°´</label>
            </div>

            <div class="module-box">
                <div class="module-header">
                    <input type="checkbox" id="run_arena" class="toggle-module">
                    <span class="module-title" style="color: #2980b9;">âš”ï¸ ç«¶æŠ€å ´</span>
                </div>
                <input type="number" id="arena_delay" value="1000" placeholder="å»¶é² (ms)">
                <div class="hint-text">é»æ“Šå¾Œçš„å»¶é²æ™‚é–“</div>
            </div>

            <div class="module-box">
                <div class="module-header">
                    <input type="checkbox" id="run_stage" class="toggle-module">
                    <span class="module-title" style="color: #8e44ad;">ğŸ° é—œå¡æŒ‘æˆ°</span>
                </div>
                <select id="stage_strategy">
                    <option value="SELF">è‡ªæˆ‘è§£æ±º (é è¨­)</option>
                    <option value="BOSS">æœ€å¾Œå¤§é­”ç‹</option>
                    <option value="OVERPOWER">å£“å€’æ€§æŠ•æ‰‹</option>
                    <option value="TECHNICAL">æŠ€å·§æ´¾æŠ•æ‰‹</option>
                </select>
                <div class="hint-text">é¸æ“‡å…‹åˆ¶æŠ€èƒ½</div>
            </div>

            <div class="module-box">
                <div class="module-header">
                    <input type="checkbox" id="run_club_battle" class="toggle-module">
                    <span class="module-title" style="color: #c0392b;">ğŸ›¡ï¸ ä¿±æ¨‚éƒ¨æˆ°</span>
                </div>
                <select id="club_battle_stars">
                    <option value="3">â­â­â­ ä¸‰æ˜Ÿå°æ‰‹</option>
                    <option value="2">â­â­ äºŒæ˜Ÿå°æ‰‹</option>
                    <option value="1">â­ ä¸€æ˜Ÿå°æ‰‹</option>
                </select>
            </div>

            <div class="module-box">
                <div class="module-header">
                    <input type="checkbox" id="run_club_challenge" class="toggle-module">
                    <span class="module-title" style="color: #d68910;">ğŸ”¥ ä¿±æ¨‚éƒ¨æŒ‘æˆ°</span>
                </div>
                <select id="club_challenge_diff">
                    <option value="EASY">Easy</option>
                    <option value="NORMAL">Normal</option>
                    <option value="HARD" selected>Hard</option>
                    <option value="EXTREME">Extreme</option>
                </select>
            </div>

        </div>

        <div class="module-box" style="margin-top: 15px; background: #fffbf0; border-color: #ffe0b2;">
            <div class="module-title" style="margin-bottom: 5px;">â³ è…³æœ¬æš«åœ (åˆ†é˜)</div>
            <input type="number" id="pauseInput" value="0" step="0.1" placeholder="è¼¸å…¥ 0 ä»£è¡¨ä¸æš«åœ">
            <div class="hint-text">è¦é–‹å§‹æ›æ©Ÿè«‹è¨­å®š0ï¼Œè‹¥è¦è¨­å®šæš«åœæ™‚é–“è«‹å¡«å…¥æ•¸å­—</div>
        </div>

        <button id="btnStart" class="btn-start">ğŸš€ æ›´æ–°è¨­å®š / é–‹å§‹æ›æ©Ÿ</button>
        <div class="hint-text" style="margin-top: 10px;">
            ğŸ’¡ æç¤ºï¼šéš¨æ™‚å¯ä»¥ä¿®æ”¹è¨­å®šä¸¦å†æ¬¡é»æ“ŠæŒ‰éˆ•ï¼Œè…³æœ¬æœƒéœ€è¦ç­‰å¾…ä¸€äº›æ™‚é–“ä»¥æ›´æ–°è¨­å®šã€‚<br>
        </div>

        <button id="btnLogout" class="btn-logout">ç™»å‡ºå¸³è™Ÿ</button>
    </div>

    <div id="status">è«‹å…ˆç™»å…¥</div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // âœ… ä½ çš„ Firebase è¨­å®š
    const firebaseConfig = {
        apiKey: "AIzaSyCFn1buQn-olqvQkMh4H_imSih_-vRlHVo",
        authDomain: "test-2a198.firebaseapp.com",
        databaseURL: "https://test-2a198-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "test-2a198",
        storageBucket: "test-2a198.firebasestorage.app",
        messagingSenderId: "217248632641",
        appId: "1:217248632641:web:187fbfd729e75967b15bc0"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    let currentUser = null;

    const statusDiv = document.getElementById('status');
    const loginArea = document.getElementById('login-area');
    const controlArea = document.getElementById('control-area');
    const userDisplay = document.getElementById('user-display');

    // ç™¼é€æŒ‡ä»¤
    const sendCommand = (cmd, extraData = {}) => {
        if (!currentUser) return;
        
        const payload = {
            command: cmd,
            timestamp: Date.now(),
            ...extraData
        };

        const updates = {};
        updates['/users/' + currentUser.uid] = payload;
        
        update(ref(db), updates)
            .then(() => {
                let msg = `âœ… è¨­å®šå·²æ›´æ–°! (å„ªå…ˆæ¨¡å¼: ${extraData.start_mode})`;
                statusDiv.innerText = msg;
                statusDiv.style.color = "green";
            })
            .catch(e => alert("ç™¼é€å¤±æ•—: " + e.message));
    };

    // ç™»å…¥
    document.getElementById('btnLogin').addEventListener('click', async () => {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        statusDiv.innerText = "â³ ç™»å…¥ä¸­...";
        try {
            await signInWithEmailAndPassword(auth, email, pass)
                .catch(err => {
                    if(err.code.includes('not-found') || err.code.includes('invalid-credential')) {
                        return createUserWithEmailAndPassword(auth, email, pass);
                    }
                    throw err;
                });
            statusDiv.innerText = "âœ… ç™»å…¥æˆåŠŸ";
            statusDiv.style.color = "green";
        } catch (error) {
            statusDiv.innerText = "âŒ " + error.message;
            statusDiv.style.color = "red";
        }
    });

    document.getElementById('btnLogout').addEventListener('click', () => signOut(auth));

    onAuthStateChanged(auth, (user) => {
        if (user) {
            currentUser = user;
            loginArea.classList.add('hidden');
            controlArea.classList.remove('hidden');
            userDisplay.innerText = user.email;
        } else {
            currentUser = null;
            loginArea.classList.remove('hidden');
            controlArea.classList.add('hidden');
            userDisplay.innerText = "è«‹å…ˆç™»å…¥";
        }
    });

    // ğŸ‘‡ æŒ‰ä¸‹é–‹å§‹ï¼šæ‰“åŒ…æ‰€æœ‰è³‡æ–™ ğŸ‘‡
    document.getElementById('btnStart').addEventListener('click', () => {
        
        // 1. å–å¾—å„ªå…ˆå•Ÿå‹•æ¨¡å¼ (Start Mode)
        const startMode = document.querySelector('input[name="startMode"]:checked').value;

        // 2. å–å¾—æš«åœæ™‚é–“
        const minutes = parseFloat(document.getElementById('pauseInput').value);
        const pauseDuration = (minutes && minutes > 0) ? Math.floor(minutes * 60 * 1000) : 0;

        // 3. æ‰“åŒ…è³‡æ–™ (åŒ…å«æ‰€æœ‰ Checkbox ç‹€æ…‹èˆ‡è©³ç´°è¨­å®š)
        const dataPackage = {
            start_mode: startMode,       // å„ªå…ˆè·‘å“ªå€‹
            duration: pauseDuration,     // æš«åœæ™‚é–“
            
            // --- æ¨¡çµ„é–‹é—œèˆ‡è¨­å®š ---
            
            // è¯è³½
            run_league: document.getElementById('run_league').checked, // æ˜¯å¦é–‹å•Ÿ
            league_equip: document.getElementById('league_equip').checked,
            league_potion: document.getElementById('league_potion').checked,
            
            // æ’å
            run_ranking: document.getElementById('run_ranking').checked, // æ˜¯å¦é–‹å•Ÿ
            ranking_equip: document.getElementById('ranking_equip').checked,
            ranking_potion: document.getElementById('ranking_potion').checked,
            
            // ç«¶æŠ€
            run_arena: document.getElementById('run_arena').checked, // æ˜¯å¦é–‹å•Ÿ
            arena_delay: parseInt(document.getElementById('arena_delay').value) || 1000,
            
            // é—œå¡æŒ‘æˆ° (æ–°)
            run_stage: document.getElementById('run_stage').checked, // æ˜¯å¦é–‹å•Ÿ
            stage_strategy: document.getElementById('stage_strategy').value, // å…‹åˆ¶æŠ€èƒ½
            
            // ä¿±æ¨‚éƒ¨æˆ° (æ–°)
            run_club_battle: document.getElementById('run_club_battle').checked, // æ˜¯å¦é–‹å•Ÿ
            club_battle_stars: document.getElementById('club_battle_stars').value, // å¹¾æ˜Ÿå°æ‰‹
            
            // ä¿±æ¨‚éƒ¨æŒ‘æˆ° (æ–°)
            run_club_challenge: document.getElementById('run_club_challenge').checked, // æ˜¯å¦é–‹å•Ÿ
            club_challenge_diff: document.getElementById('club_challenge_diff').value // é›£åº¦
        };

        // 4. ç™¼é€ START æŒ‡ä»¤ (ä¸å†æœ‰ STOP æŒ‰éˆ•ï¼Œç”¨ START æ›´æ–°åƒæ•¸)
        sendCommand('START', dataPackage);
    });

</script>
</body>
</html>